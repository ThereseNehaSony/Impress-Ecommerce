<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title> Product Edit</title>
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
    <!-- Font Awesome CSS -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
    <link rel="stylesheet" type="text/css" href="/style1.css">

    
</head>
    <style>
        /* Additional custom styles */
        /* You can add more specific styles as needed */
        .sidebar {
            position: fixed;
            top: 0;
            left: 0;
            height: 100%;
            width: 250px;
            background-color: #f5f5f5;
            padding-top: 20px;
        }
        .main-content {
            margin-left: 250px; /* Same as sidebar width */
            padding: 20px;
        }
    </style>
</head>
<body>

<!-- Sidebar -->
<div class="sidebar">
  <a href="/admin/admindash">  <i class="fa fa-home" style="margin-right: 10px;"></i>Dashboard</a>
  <a href="/admin/product"><i class="fa fa-product-hunt" style="margin-right: 10px;" aria-hidden="true"></i>Products</a>
  <a href="/admin/category"><i class="fa fa-list" style="margin-right: 10px;" aria-hidden="true"></i>Category</a>

  <a href="/admin/customers"><i class="fa fa-users" style="margin-right: 10px;" aria-hidden="true"></i>Customers</a>
  <a href="/admin/order"><i class="fa fa-bars" style="margin-right: 10px;" aria-hidden="true"></i>Orders</a>
  <a href="/admin/coupon"><i class="fa fa-ticket" style="margin-right: 10px;" aria-hidden="true"></i>Coupons</a>
  <!-- <a href="/admin/sales"><i class="fa fa-line-chart" style="margin-right: 10px;" aria-hidden="true"></i>Sales</a> -->
  <a href="/admin/banner"><i class="fa fa-clone" style="margin-right: 10px;" aria-hidden="true"></i>Banner</a>
  <a href="/admin/productoffer"><i class="fa fa-percent" style="margin-right: 10px;" aria-hidden="true"></i>Product Offer</a>
  <a href="/admin/categoryoffer"><i class="fa fa-percent" style="margin-right: 10px;" aria-hidden="true"></i>Category Offer</a>
  <a href="/admin/messages"><i class="fa fa-comments" style="margin-right: 10px;" aria-hidden="true"></i>Messages</a>
  <a href="/admin/logout"><i class="fa fa-sign-out" style="margin-right: 10px;" aria-hidden="true"></i>Logout</a>
</div>

<!-- Main Content -->
<div class="main-content">
    <div class="boxtop">
        <div class="icon">
          <i class="fa fa-product-hunt"></i> 
        </div>
        <h2>Product </h2>
       
      </div>
      <h5 style="margin-top: 20px;">Edit Product</h5>
      <form action="/admin/updateproduct/<%= product._id %>" method="POST" enctype="multipart/form-data">
 <!-- First Line  -->
<div class="row">
  <div class="col-md-6">
    <div class="form-group">
      <label for="productName">Name</label>
      <input type="text" class="form-control" id="productName" name="name" value="<%= product.name %>">
      <label for="isNewArrival">New Arrival:</label>
      <input type="checkbox" id="isNewArrival" name="isNewArrival" <% if (product.isNewArrival) { %> checked <% } %>>
  </div>
  </div>
</div>

<!-- Second Line  -->
<div class="row">
  <div class="col-md-4">
    <div class="form-group">
      <label for="productCategory">Category</label>
      <select class="form-control" id="productCategory" name="category">
        <% categories.forEach(category => { %>
          <option value="<%= category._id.toString() %>" <%= product.category.equals(category._id) ? 'selected' : '' %>><%= category.name %></option>
        <% }); %>
      </select>
    </div>
  </div>



  <div class="col-md-4">
    <div class="form-group">
      <label for="productColor">Color</label>
      <input type="text" class="form-control" id="productColor" name="color" value="<%= product.color %>">
    </div>
  </div>
  <div class="col-md-4">
    <div class="form-group">
      <label for="productPrice">Price</label>
      
      <input type="text" class="form-control" id="productPrice" name="price" value="<%= product.price %>">
      
    </div>
  </div>
</div>


<!-- Third Line  -->
<div class="row">
  <div class="col-md-4">
    <div class="form-group">
      <label for="productSize">Size</label>
    
      <select class="form-control" id="productSize" name="size" >
        <option value=""><%= product.size %></option>
        <option value="Freesize">Freesize</option>
        <option value="S">S</option>
        <option value="M">M</option>
        <option value="L">L</option>
        <option value="XL">XL</option>
        <option value="XXL">XXL</option>
        <option value="XXXL">XXXL</option>
      </select>
    </div>
  </div>
  <div class="col-md-4">
    <div class="form-group">
      <label for="productMaterial">Material</label>
      <input type="text" class="form-control" id="productMaterial" name="material" value="<%= product.material %>">
    </div>
  </div>
  <div class="col-md-4">
    <div class="form-group">
      <label for="productWashcare">Washcare</label>
      <input type="text" class="form-control" id="productWashcare" name="washcare" value="<%= product.washcare %>">
    </div>
  </div>
</div>

<!-- Fourth Line  -->
<div class="row">
  <div class="col-md-6">
    <div class="form-group">
      <label for="productOccasion">Stock</label>
      <input type="text" class="form-control" id="productOccasion" name="stock" value="<%= product.stock %>">
    </div>
  </div>
  <div class="col-md-6">
  
</div>
<div class="col-md-6">
  <div class="form-group">
    <label for="productSpecification">Specifications</label>
    <textarea class="form-control" id="productSpecification" name="specification" rows="5"> <%= product.specification %></textarea>
    <div id="specificationError" class="error-message"></div>
  </div>

<div class="col-md-12">
  <h5>Product Photos</h5>
  <!-- Display existing product photos -->
  <div class="uploaded-photos">
    <% product.photos.forEach(function(photo, index) { %>
      <div class="col-sm-4 mb-2">
        <img src="/uploads/<%= photo %>" alt="Product Photo" class="img-fluid" width="200px">
        <!-- Delete button for existing photos -->
        <button class="delete-btn" data-index="<%= index %>">Delete</button>
      </div>
    <% }); %>
  </div>
<!-- Input field to hold deleted photo filenames -->
<input type="hidden" id="deletedPhotos" name="deletedPhotos" value="">

  <!-- Input for adding new or changing existing product photos -->
  <div class="input-group mt-3">
    <input type="file" class="form-control-file" id="productPhotos" name="photos" multiple onchange="displaySelectedPhotos(event)">
  </div>
</div>







        <!-- Sixth Line -->
        <!-- <div class="form-row">
          <div class="form-group col-md-8">
            <label for="productPhoto">Photo</label>
            <div class="uploaded-photos">
                <div class="row">
                  <div class="col-sm-4 mb-2">
                    <img src="/images/01,1.jpg" alt="Uploaded Photo 1" class="img-fluid">
                   
                  </div>
                  <div class="col-sm-4 mb-2">
                    <img src="/images/01,2.jpg" alt="Uploaded Photo 2" class="img-fluid">
                  
                  </div>
                  <div class="col-sm-4 mb-2">
                    <img src="/images/01,3.jpg" alt="Uploaded Photo 3" class="img-fluid">
                   
                  </div>
                </div>
              </div>
            <div class="input-group">
              <input type="file" class="form-control-file" id="productPhoto">
              <div class="input-group-append">
                <button class="btn btn-secondary " style="margin-top: 20px;" type="button">Upload</button>
              </div>
            </div>
          </div>
        </div> -->
        
        <!-- Save Button -->
        <button type="submit" class="btn btn-primary" style="margin-top: 20px;">Save</button>
      </form>
      
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js"></script>
<script>
 function displaySelectedPhotos(event) {
  const preview = document.querySelector('.uploaded-photos');
  const files = event.target.files;

  if (preview.childElementCount + files.length > 4) {
    alert('You can upload a maximum of 4 photos.');
    return;
  }

  for (let i = 0; i < files.length; i++) {
    const fileReader = new FileReader();

    fileReader.onload = function (e) {
      const image = document.createElement('img');
      image.src = e.target.result;
      image.alt = 'Selected Photo';
      image.classList.add('img-fluid');
      image.width = 200;

      const deleteBtn = document.createElement('button');
      deleteBtn.textContent = 'Delete';
      deleteBtn.classList.add('delete-btn');
      deleteBtn.addEventListener('click', function () {
        preview.removeChild(div);
      });

      const div = document.createElement('div');
      div.classList.add('col-sm-4', 'mb-2');
      div.appendChild(image);
      div.appendChild(deleteBtn);

      preview.appendChild(div);
    };

    fileReader.readAsDataURL(files[i]);
  }
}

// Event delegation for dynamically added delete buttons
document.addEventListener('click', function (event) {
  if (event.target.classList.contains('delete-btn')) {
    const div = event.target.parentElement;
    const filename = div.querySelector('img').src.split('/').pop(); // Extract filename from image src

    // Remove deleted image from the UI
    div.parentElement.removeChild(div);

    // Update the hidden input field with the filename of the deleted photo
    const deletedPhotosInput = document.getElementById('deletedPhotos');
    const deletedPhotos = deletedPhotosInput.value.split(',');
    deletedPhotos.push(filename);
    deletedPhotosInput.value = deletedPhotos.join(',');
  }

});



  
</script>

</body>
</html>
