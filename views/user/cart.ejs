
<%- include('header')  -%>
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>User Profile</title>
 
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@10"></script>
  
<style>
   

    .avatar-lg {
        height: 5rem;
        width: 5rem;
    }
    
    .font-size-18 {
        font-size: 18px!important;
    }
    
    .text-truncate {
        overflow: hidden;
        text-overflow: ellipsis;
        white-space: nowrap;
    }
    
    a {
        text-decoration: none!important;
    }
    
    .w-xl {
        min-width: 160px;
    }
    
    .card {
        margin-bottom: 24px;
        -webkit-box-shadow: 0 2px 3px #e4e8f0;
        box-shadow: 0 2px 3px #e4e8f0;
    }
    
    .card {
        position: relative;
        display: -webkit-box;
        display: -ms-flexbox;
        display: flex;
        -webkit-box-orient: vertical;
        -webkit-box-direction: normal;
        -ms-flex-direction: column;
        flex-direction: column;
        min-width: 0;
        word-wrap: break-word;
        background-color: #fff;
        background-clip: border-box;
        border: 1px solid #eff0f2;
        border-radius: 1rem;
    }
    </style>
</head>
<body>


  
  
  <div class="container-fluid">
    <div class="row">
      <nav id="sidebar" class="col-md-3 col-lg-2 d-md-block  sidebar">
        <div class="position-sticky">
          <div style="margin-left: 50px; margin-top: 30px;">
            <a href="#" class="list-group-item list-group-item-action"><b>Manage My Account</b></a>
            <ul class="pl-4">
              <li><a href="/profile" class="list-group-item list-group-item-action" style="list-style: none;">Profile</a></li>
              <li><a href="/useraddress" class="list-group-item list-group-item-action">Address Book</a></li>
              <li><a href="/changepassword" class="list-group-item list-group-item-action">Change Password</a></li>
            </ul>
            <a href="/orders" class="list-group-item list-group-item-action"><b>Orders</b></a><br>
            <!-- <ul class="pl-4">
              <li><a href="#" class="list-group-item list-group-item-action" style="list-style: none;">Orders</a></li>
              <li><a href="#" class="list-group-item list-group-item-action">Returns</a></li>
              <li><a href="#" class="list-group-item list-group-item-action">Cancellations</a></li>
            </ul> -->
            <a href="/cart" class="list-group-item list-group-item-action"><b>Cart</a></b><br>
            <a href="/wishlist" class="list-group-item list-group-item-action"><b>Wishlist</a></b><br>
         
          </div>
        </div>
      </nav>
      <main class="col-md-9 ms-sm-auto col-lg-10 px-md-4">
        <div class="container">
            <div class="row">
                <div class="col-xl-8">
                  <% let totalPrice = 0; %>
                <% if (userCart && userCart.items.length > 0) { %>
                    <% userCart.items.forEach(item => { %>
                        <% let itemPrice = item.productId.price * item.quantity; %>
                        <% totalPrice += itemPrice; %>
                            <div class="card border shadow-none mb-3">
                                <div class="card-body">
                                    <div class="d-flex align-items-start border-bottom pb-3">
                                        <div class="me-4">
                                            <img src="uploads/<%= item.productId.photos[0] %>" alt="" class="avatar-lg rounded">
                                        </div>
                                        <div class="flex-grow-1 align-self-center overflow-hidden">
                                            <div>
                                                <h5 class="text-truncate font-size-18"><%= item.productId.name %></h5>
                                                <!-- Other details about the product -->
                                                <!-- ... -->
                                                <p>Color: <span class="fw-medium"><%= item.productId.washcare %></span></p>
                                            </div>
                                        </div>
                                        <div class="flex-shrink-0 ms-2">
                                            <ul class="list-inline mb-0 font-size-16">
                                                <li class="list-inline-item">
                                                    <a href="#" class="text-muted px-1">
                                                        <i class="mdi mdi-trash-can-outline"></i>
                                                    </a>
                                                </li>
                                                <li class="list-inline-item">
                                                    <a href="#" class="text-muted px-1">
                                                        <i class="fa fa-heart"></i>
                                                        <button class="btn btn-light border text-danger icon-hover-danger removeButton" data-product-id="<%= item.productId._id %>">
                                                            Remove
                                                        </button>
                                                        <!-- <a href="#" class="btn btn-light border text-danger icon-hover-danger">Remove</a> -->
                                                    </a>
                                                </li>
                                            </ul>
                                        </div>
                                    </div>
    
                                    <div class="row">
                                        <div class="col-md-4">
                                            <div class="mt-3">
                                                <p class="text-muted mb-2">Price</p>
                                               
                                                <h5 class="mb-0 mt-2">₹<%= item.productId.price %></h5>
                                            </div>
                                        </div>
                                        <div class="col-md-5">
                                            <div class="mt-3">
                                                <p class="text-muted mb-2">Quantity</p>
                                                <div class="d-inline-flex">

                                                    
                                                    <button class="btn btn-sm btn-outline-secondary decrement-btn" data-product-id="<%= item.productId._id %>"  style="margin-right: 10px;font-size: 20px;">-</button>
                                                    <input class="form-control form-control-sm quantity-input" type="number" value="<%= item.quantity %>" min="1" max="10" disabled>
                                                    <button class="btn btn-sm btn-outline-secondary increment-btn" data-product-id="<%= item.productId._id %>"  style="font-size: 20px;">+</button>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="col-md-3">
                                            <div class="mt-3">
                                                <p class="text-muted mb-2">Total</p>
                                              
                                                <h5>₹<%= item.productId.price * item.quantity %></h5>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        <% }); %>
                    <% } else { %>
                        <p>No items in the cart</p>
                    <% } %>
                </div>
            <!-- </div>
        </div> -->

    




        <div class="col-lg-4">
          <div class="card mb-3 border shadow-0">
              <div class="card-body">
                  <form>
                      <div class="form-group">
                          <label class="form-label">Have a coupon?</label>
                          <div class="input-group">
                              <input type="text" class="form-control border" name="" placeholder="Coupon code" />
                              <button class="btn btn-light border">Apply</button>
                          </div>
                      </div>
                  </form>
              </div>
          </div>
          <div class="card shadow-0 border">
            <div class="card-body">
              <div class="d-flex justify-content-between">
                <p class="mb-2">Total price:</p>
                <p class="mb-2">₹<%= totalPrice %></p>
              </div>
              <div class="d-flex justify-content-between">
                <p class="mb-2">Discount:</p>
                <!-- <p class="mb-2 text-success">-$60.00</p> -->
              </div>
              <div class="d-flex justify-content-between">
                <p class="mb-2">TAX:</p>
                <!-- <p class="mb-2">$14.00</p> -->
              </div>
              <hr />
              <div class="d-flex justify-content-between">
                <p class="mb-2">Total price:</p>
                <p class="mb-2 fw-bold">₹<%= totalPrice %></p>
              </div>
                  <div class="mt-3">
                      <a href="/checkout" class="btn btn-success w-100 shadow-0 mb-2">Proceed</a>
                      <a href="#" class="btn btn-light w-100 border mt-2">Back to shop</a>
                  </div>
              </div>
          </div>
      </div>
  </div>
</div>
</main>
<script>

$('.removeButton').on('click', function(e) {
    e.preventDefault();
    const productId = $(this).data('product-id');
    const $clickedButton = $(this);

    $.ajax({
        url: '/removeFromCart',
        type: 'DELETE',
        data: { productId: productId },
        success: function(response) {
            if (response.message === 'Product removed from cart successfully') {
              
                $clickedButton.closest('.card').remove();
                
             
                Swal.fire({
          icon: 'success',
          title: 'Success',
          text: 'Item removed from cart successfully'
        });
            }
        },
        error: function(error) {
            console.error('Error:', error);
          
        }
    });
});


</script>   
<script>
$(document).on('click', '.increment-btn', function() {
    const productId = $(this).data('product-id'); 
    const quantityInput = $(this).siblings('.quantity-input');
    const currentQuantity = parseInt(quantityInput.val());
    const newQuantity = currentQuantity + 1;

    updateCartItemQuantity(productId, newQuantity);
});

$(document).on('click', '.decrement-btn', function() {
    const productId = $(this).data('product-id');
    const quantityInput = $(this).siblings('.quantity-input');
    const currentQuantity = parseInt(quantityInput.val());
    const newQuantity = currentQuantity - 1;

    if (newQuantity >= 1) {
        updateCartItemQuantity(productId, newQuantity);
    }
});
function updateCartItemQuantity(productId, newQuantity) {
    $.ajax({
        type: 'PUT',
        url: `/updateCartItemQuantity/${productId}`, 
        contentType: 'application/json',
        data: JSON.stringify({ quantity: newQuantity , productId: productId,}),
        success: function(response) {
            console.log('Cart updated successfully');
            const quantityInput = $(`.quantity-input[data-product-id="${productId}"]`);
            quantityInput.val(newQuantity);
        },
        error: function(error) {
            console.error('Failed to update cart', error);
            
        }
    });
}
</script>

  <%-include('footer') -%>
